
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Compiling and Running oneAPI programs &#8212; UnoAPI: Modern Parallel C++ Programming with SYCL and oneAPI v0.6</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=466cad66"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '80-running/running';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Contribution Guildelines" href="../90-contributions/contributions.html" />
    <link rel="prev" title="Performance Essentials" href="../30-performance/performance.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  

  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
  
    <p class="title logo__title">UnoAPI: Modern Parallel C++ Programming with SYCL and oneAPI v0.6</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Table of Contents</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../00-preliminaries/preliminaries.html">About the Book</a></li>
<li class="toctree-l1"><a class="reference internal" href="../05-parallel/parallel.html">Introduction to Parallel Programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="../10-software-engineering/software-engineering.html">Introduction to Software Engineering</a></li>
<li class="toctree-l1"><a class="reference internal" href="../15-modern-cpp/modern-cpp.html">Modern C++ as a Better C (and C++)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../18-dpcpp/dpcpp.html">Data-Parallel C++ with oneAPI/SYCL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../20-quant-finance/qfi.html">Quantitative Finance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../30-performance/performance.html">Performance Essentials</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Compiling and Running oneAPI programs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../90-contributions/contributions.html">Contribution Guildelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../91-coc/code-of-conduct.html">Code of Conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="../92-marching-cubes/marching-cubes.html">Marching Cubes: From CUDA to SYCL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../93-electron-density/electron-density.html">Electron Density Case Study</a></li>
<li class="toctree-l1"><a class="reference internal" href="../99-chapter-template/chapter-title.html">Chapter Title</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/80-running/running.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Compiling and Running oneAPI programs</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#running-the-examples-on-github-as-a-fork-of-the-original-repo-browser-based">Running the examples on GitHub as a fork of the original repo (browser-based)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#running-the-examples-locally">Running the examples locally</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#running-the-examples-on-the-intel-devcloud">Running the examples on the Intel DevCloud</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#running-on-polaris-supercomputer">Running on Polaris Supercomputer</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#running-on-cloud-based-virtual-machines">Running on cloud-based virtual machines</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#running-on-hardware-with-nvidia-gpus">Running on hardware with NVIDIA GPUs</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="compiling-and-running-oneapi-programs">
<h1>Compiling and Running oneAPI programs<a class="headerlink" href="#compiling-and-running-oneapi-programs" title="Link to this heading">#</a></h1>
<p>Our examples are CMake-based CPP projects along with unit tests in source form.
They are publicly available as a GitHub repository under the Apache 2.0 open-source license at <a class="reference external" href="https://github.com/LoyolaChicagoCode/unoapi-dpcpp-examples">github.com/LoyolaChicagoCode/unoapi-dpcpp-examples</a>.</p>
<p>The examples include a README file with instructions for building and running on Debian-based Linux systems (including Ubuntu), as well as the scripts needed to run the experiments described in this paper.</p>
<p>The full documentation of the LLVM-based oneAPI DPC++ compilation toolchain is available at <a class="reference external" href="https://intel.github.io/llvm-docs">intel.github.io/llvm-docs</a>.</p>
<section id="running-the-examples-on-github-as-a-fork-of-the-original-repo-browser-based">
<h2>Running the examples on GitHub as a fork of the original repo (browser-based)<a class="headerlink" href="#running-the-examples-on-github-as-a-fork-of-the-original-repo-browser-based" title="Link to this heading">#</a></h2>
<p>The repository is configured with continuous integration (CI) using the following GitHub Actions workflow:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>steps:
-<span class="w"> </span>name:<span class="w"> </span>Checkout<span class="w"> </span>project<span class="w"> </span>code
<span class="w">  </span>uses:<span class="w"> </span>actions/checkout@v2

-<span class="w"> </span>name:<span class="w"> </span>Install<span class="w"> </span>Intel<span class="w"> </span>oneAPI
<span class="w">  </span>timeout-minutes:<span class="w"> </span><span class="m">5</span>
<span class="w">  </span>run:<span class="w"> </span><span class="p">|</span>
<span class="w">    </span>./install-dpcpp.sh

-<span class="w"> </span>name:<span class="w"> </span>Set<span class="w"> </span>oneAPI<span class="w"> </span>environment
<span class="w">  </span>run:<span class="w"> </span><span class="p">|</span>
<span class="w">    </span><span class="nb">source</span><span class="w"> </span>./setvars.sh
<span class="w">    </span>printenv<span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="nv">$GITHUB_ENV</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span>/opt/intel/oneapi/compiler/latest/linux/bin-llvm<span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="nv">$GITHUB_PATH</span>

-<span class="w"> </span>name:<span class="w"> </span>CMake<span class="w"> </span>configure
<span class="w">  </span>run:<span class="w"> </span>cmake<span class="w"> </span>-DCMAKE_BUILD_TYPE<span class="o">=</span>Debug<span class="w"> </span>-S<span class="w"> </span>.<span class="w"> </span>-B<span class="w"> </span><span class="nv">$BUILD_DIR</span>

-<span class="w"> </span>name:<span class="w"> </span>CMake<span class="w"> </span>build
<span class="w">  </span>run:<span class="w"> </span>cmake<span class="w"> </span>--build<span class="w"> </span><span class="nv">$BUILD_DIR</span>

-<span class="w"> </span>name:<span class="w"> </span>CMake<span class="w"> </span><span class="nb">test</span>
<span class="w">  </span>run:<span class="w"> </span><span class="p">|</span>
<span class="w">    </span><span class="nv">$BUILD_DIR</span>/bin/integration
<span class="w">    </span><span class="nv">$BUILD_DIR</span>/bin/matrix_mul_dpc
<span class="w">    </span><span class="nv">$BUILD_DIR</span>/bin/montecarlo
<span class="w">    </span><span class="c1"># eventually keep only this loop for discovering all tests</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span>test_bin<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nv">$BUILD_DIR</span>/bin/*tests<span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="s2">&quot;./</span><span class="nv">$test_bin</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">done</span>
</pre></div>
</div>
<p>It relies on this prerequisite installation script, which one can also invoke manually on a local workstation:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>

<span class="c1"># Prerequisite: recent Ubuntu environment</span>

<span class="nb">echo</span><span class="w"> </span>Add<span class="w"> </span>Intel<span class="w"> </span>Apt<span class="w"> </span>repository

wget<span class="w"> </span>-qO-<span class="w"> </span>https://apt.repos.intel.com/intel-gpg-keys/GPG-PUB-KEY-INTEL-SW-PRODUCTS.PUB<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/apt/trusted.gpg.d/GPG-PUB-KEY-INTEL-SW-PRODUCTS.asc
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;deb https://apt.repos.intel.com/oneapi all main&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/apt/sources.list.d/oneAPI.list
sudo<span class="w"> </span>apt<span class="w"> </span>update<span class="w"> </span>-q
<span class="w">        </span>
<span class="nb">echo</span><span class="w"> </span>Install<span class="w"> </span>Intel<span class="w"> </span>oneAPI

sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>-q<span class="w"> </span>-y<span class="w"> </span>intel-oneapi-compiler-dpcpp-cpp

<span class="nb">echo</span><span class="w"> </span>Done
</pre></div>
</div>
<p>Every commit or pull request to the repository triggers a build and results in an indication of successful or unsuccessful completion of the build, including execution of the unit test suite.
This option is subject to limitations in devices available through the actual CI container (i.e., not usually accelerators).</p>
<p>These are the steps to copy, build, and run the artifact in a web browser without involving a local build environment.</p>
<ul class="simple">
<li><p>Visit <a class="reference external" href="https://github.com/LoyolaChicagoCode/unoapi-dpcpp-examples">github.com/LoyolaChicagoCode/unoapi-dpcpp-examples</a>.</p></li>
<li><p>Near the top right corner, look for the Fork button, click on the dropdown, and select “Create a new fork.”</p></li>
<li><p>Create the new fork in your GitHub account or organization.</p></li>
<li><p>Visit the Actions tab, where you will see the message “Workflows aren’t being run on this forked repository.”</p></li>
<li><p>Click on the green button labeled “I understand my workflows, go ahead and enable them.”</p></li>
<li><p>Use the web interface to create a file, say “dummy.txt”, to trigger a workflow run. This will create an entry under the GitHub actions tab for this workflow run. To observe execution in real time or after completion, one can drill into this entry until the step-by-step execution log appears.</p></li>
</ul>
</section>
<section id="running-the-examples-locally">
<h2>Running the examples locally<a class="headerlink" href="#running-the-examples-locally" title="Link to this heading">#</a></h2>
<p>This option requires a physical or virtual Debian-based system on Intel hardware, which may include an accelerator, such as a GPU.
The specific steps are documented in the top-level README file in the GitHub repository.
The artifact’s main executable is self-documenting using the <code class="docutils literal notranslate"><span class="pre">-h</span></code> or <code class="docutils literal notranslate"><span class="pre">–help</span></code> CLI option.</p>
<p>The Intel oneAPI DPC++ toolchain is currently supported on Linux and Windows (64-bit).
It is possible to develop DPC++ applications on Intel-based MacOS computers by doing so within a Linux virtual machine.</p>
</section>
<section id="running-the-examples-on-the-intel-devcloud">
<h2>Running the examples on the Intel DevCloud<a class="headerlink" href="#running-the-examples-on-the-intel-devcloud" title="Link to this heading">#</a></h2>
<p>This option requires a (free) account on Intel’s DevCloud for working with oneAPI and provides access to various types of accelerators, such as GPUs based on the gen9 architecture we’ve used for the sample runs shown above; it thereby provides a highe degree of reproducibility.
Once access to DevCloud has been established, the specific steps are documented in the top-level README file in the GitHub repository.</p>
<p>Concretely, on a DevCloud compute node, one can use OpenCL’s <code class="docutils literal notranslate"><span class="pre">clinfo</span></code> command to discover the available accelerators:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>u204386@s001-n140:~$ clinfo -l
Platform #0: Intel(R) OpenCL
`-- Device #0: Intel(R) Xeon(R) E-2176G CPU @ 3.70GHz
Platform #1: Intel(R) OpenCL HD Graphics
`-- Device #0: Intel(R) UHD Graphics P630 [0x3e96]
</pre></div>
</div>
<p>Better yet, after running the oneAPI setvars.sh script, one can use SYCL’s <code class="docutils literal notranslate"><span class="pre">sycl-ls</span></code> command to do the same thing:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>u204386@s001-n140:~/Work/unoapi-dpcpp-examples$ sycl-ls
[opencl:cpu:0] Intel(R) OpenCL, Intel(R) Xeon(R) E-2176G CPU @ 3.70GHz 3.0 [2023.16.7.0.21_160000]
[opencl:gpu:1] Intel(R) OpenCL HD Graphics, Intel(R) UHD Graphics P630 [0x3e96] 3.0 [22.28.23726.1]
[ext_oneapi_level_zero:gpu:0] Intel(R) Level-Zero, Intel(R) UHD Graphics P630 [0x3e96] 1.3 [1.3.23726]
</pre></div>
</div>
<p>At the time of this writing, DevCloud provides well over 200 compute nodes with various types of accelerators, including field-programmable gate arrays (FPGAs).
Some accelerators, however, don’t support certain types of data, e.g., 64-bit floating point numbers.</p>
</section>
<section id="running-on-polaris-supercomputer">
<h2>Running on Polaris Supercomputer<a class="headerlink" href="#running-on-polaris-supercomputer" title="Link to this heading">#</a></h2>
<p>“Polaris is a supercomputer developed in collaboration with Hewlett Packard Enterprise (HPE), Polaris is a leading-edge system that will give scientists and application developers a platform to test and optimize codes for Aurora, Argonne’s upcoming Intel-HPE exascale supercomputer.”</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The above description is verbatim from the <a class="reference external" href="https://www.alcf.anl.gov/polaris/">Polaris</a> web page at Argonne National Laboratory and is intended to provide basic background about this computer. You are encouraged to consult the Polaris documentation for additional details. These are preliminary notes and have not been through-drafted or edited.</p>
</div>
<p>The Polaris system makes use of the <strong>modules</strong> system to support additional packages that are not readily available in the default package manager.
Modules are provided for many things that are of a fast-changing nature and often need to be built from source.
At the time of writing, the open source compilers for SYCL (and based on LLVM) are compiled from source on Polaris and distributed as module.</p>
<p>In addition, many of the things we require for this book (e.g. <code class="docutils literal notranslate"><span class="pre">cmake</span></code> support) are also distributed as modules.</p>
<p>To install the needed modules, do the following:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>module use /soft/modulefiles
module load oneapi/upstream
module load nvhpc-mixed
module load craype-accel-nvidia80
module unload nvhpc-mixed
module load spack-pe-base cmake
</pre></div>
</div>
<p>If you are planning to use MPI and SYCL together (we do not in this book yet) then you need to install the following additional modules and set an environment variable to enable GPGPU support within MPI.
If you don’t need MPI, the following is not needed (i.e. is optional).</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>module load mpiwrappers/cray-mpich-oneapi-upstream
export MPICH_GPU_SUPPORT_ENABLED=1
</pre></div>
</div>
<p>In addition, you will need to set the following variables to allow for building our examples using the NVIDIA support on Polaris (via the above modules):</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>EXTRA_FLAGS=&quot;-sycl-std=2020 -O3 -fsycl -fsycl-targets=nvptx64-nvidia-cuda -Xsycl-target-backend --cuda-gpu-arch=sm_80&quot;
export CFLAGS=&quot;-ffp-model=precise&quot;
export CXXFLAGS=&quot;-ffp-model=precise -fsycl $EXTRA_FLAGS&quot;
export CC=clang
export CXX=clang++
</pre></div>
</div>
<p>Once you do this, you can build our exaxmples using our <code class="docutils literal notranslate"><span class="pre">cmake</span></code> based build process.</p>
<p>Then it is a matter of using PBS to schedule your job for execution.  Here is an example of how to schedule a one node job on the debug queue.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>qsub -q debug -A YourAllocationHere -l select=1:system=polaris -l walltime=00:59:00 -l filesystems=home -I
</pre></div>
</div>
<p>The following explains the <code class="docutils literal notranslate"><span class="pre">qsub</span></code> command shown here. For additional details, you will need to read the Polaris documentation.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-q</span> <span class="pre">debug</span></code> selects the debug queue (one GPGPU node only)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-A</span> <span class="pre">YourAllocationHere</span></code> is required, meaning you must have an allocation via an approved project in ALCF. You cannot run jobs without one.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-l</span> <span class="pre">select=1:system=polaris</span></code> is used to specify the selection of nodes (one node on Polaris)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-l</span> <span class="pre">walltime=00:59:00</span></code> is the amount of time you wish to request</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-l</span> <span class="pre">filesystems=home</span></code> is to make your home directory available on each node allocated</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-I</span></code> interactive execution (opens a shell once you get a node; plan to wait a while!)</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We will be providing a job script shortly. We still testing. I also plan to make a video as working with production clusters like Polaris is always tricky when it comes to these rapidly-evolving platforms with so many moving parts.</p>
</div>
</section>
<section id="running-on-cloud-based-virtual-machines">
<h2>Running on cloud-based virtual machines<a class="headerlink" href="#running-on-cloud-based-virtual-machines" title="Link to this heading">#</a></h2>
<p>We can actually run data-parallel code on an Intel-based virtual machine, e.g., Microsoft Azure; in some cases, installing the OpenCL headers might be required in addition to the DPC++ compiler toolchain:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>sudo apt install opencl-clhpp-headers
</pre></div>
</div>
<p>After running the oneAPI setvars.sh script, <code class="docutils literal notranslate"><span class="pre">sycl-ls</span></code> reports the available accelerators.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>comp141@ML-RefVm-775968:~/Work/unoapi-dpcpp-examples$ sycl-ls
[opencl:acc:0] Intel(R) FPGA Emulation Platform for OpenCL(TM), Intel(R) FPGA Emulation Device 1.2 [2023.16.7.0.21_160000]
[opencl:cpu:1] Intel(R) OpenCL, Intel(R) Xeon(R) Platinum 8171M CPU @ 2.60GHz 3.0 [2023.16.7.0.21_160000]
</pre></div>
</div>
<p>On Gitpod, the installation and compilation steps work as intended, and sequential execution is supported.
this environment doesn’t support the execution of data-parallel code, not even using the CPU itself as an accelerator, possibly because of kernel configuration settings.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Machine:
  Type: Docker Mobo: Google model: Google Compute Engine serial: &lt;superuser required&gt; BIOS: Google v: Google date: 08/04/2023
  CPU:
    Info: 8-core model: AMD EPYC 7B13 bits: 64 type: MT MCP cache: L2: 4 MiB
</pre></div>
</div>
<p>Accordingly, <code class="docutils literal notranslate"><span class="pre">sycl-ls</span></code> doesn’t return anything.</p>
</section>
<section id="running-on-hardware-with-nvidia-gpus">
<span id="running-on-nvidia"></span><h2>Running on hardware with NVIDIA GPUs<a class="headerlink" href="#running-on-hardware-with-nvidia-gpus" title="Link to this heading">#</a></h2>
<p>The oneAPI plugin for NVIDIA GPUs is currently in beta testing.
Detailed instructions are <a class="reference external" href="https://developer.codeplay.com/products/oneapi/nvidia/2023.2.1/guides/get-started-guide-nvidia">available from Codeplay</a>.</p>
<p>In particular, the plugin uses the LLVM-based oneAPI DPC++ toolchain.
To build our example in a separate build directory targeting the NVIDIA GPU, which is not binary-compatible with the default one targeting the host CPU, we can perform the following steps:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>$ . ./setvars.sh
$ CXXFLAGS=&quot;$CXXFLAGS -fsycl-targets=nvptx64-nvidia-cuda&quot; cmake -DCMAKE_BUILD_TYPE=Release -S . -B build-nvidia
$ CXXFLAGS=&quot;$CXXFLAGS -fsycl-targets=nvptx64-nvidia-cuda&quot; cmake --build build-nvidia
$ ONEAPI_DEVICE_SELECTOR=cuda:\* ./build-nvidia/bin/integration -n 10000000 -w 1000
[2023-10-08 01:48:10.176] [info] integrating function from 0 to 1 using 10000000 trapezoid(s), dx = 1e-07
[2023-10-08 01:48:10.176] [info] preparing for vectorized integration
[2023-10-08 01:48:10.696] [info] Device: NVIDIA RTX A6000
[2023-10-08 01:48:10.697] [info] done submitting to queue...waiting for results
[2023-10-08 01:48:15.505] [info] result should be available now
result = 1.0000000000000013
[2023-10-08 01:48:15.506] [info] all done for now
</pre></div>
</div>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../30-performance/performance.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Performance Essentials</p>
      </div>
    </a>
    <a class="right-next"
       href="../90-contributions/contributions.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Contribution Guildelines</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#running-the-examples-on-github-as-a-fork-of-the-original-repo-browser-based">Running the examples on GitHub as a fork of the original repo (browser-based)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#running-the-examples-locally">Running the examples locally</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#running-the-examples-on-the-intel-devcloud">Running the examples on the Intel DevCloud</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#running-on-polaris-supercomputer">Running on Polaris Supercomputer</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#running-on-cloud-based-virtual-machines">Running on cloud-based virtual machines</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#running-on-hardware-with-nvidia-gpus">Running on hardware with NVIDIA GPUs</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Author name not set
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023-Present, George K. Thiruvathukal and Konstantin Läufer.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>